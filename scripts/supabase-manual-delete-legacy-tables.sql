-- =============================================================================
-- レガシーテーブル削除スクリプト（Supabase手動実行用）
-- =============================================================================
-- 作成日: 2025年10月1日
-- 用途: Supabase Dashboard の SQL Editor で手動実行
-- 対象: 8つのレガシーテーブル
-- 注意: 削除前にバックアップを必ず取得してください
-- =============================================================================

-- 削除順序（依存関係を考慮）
-- 1. detailed_quiz_data
-- 2. quiz_results  
-- 3. user_progress
-- 4. category_progress
-- 5. user_subcategory_xp_stats (v1)
-- 6. user_category_xp_stats (v1) 
-- 7. user_xp_stats (v1)
-- 8. xp_settings

-- =============================================================================
-- ⚠️ 実行前の確認事項
-- =============================================================================
-- 1. バックアップが完了していることを確認
-- 2. 本スクリプトを1つずつ実行することを推奨
-- 3. 各削除後にアプリケーションの動作確認を実施
-- =============================================================================

-- -----------------------------------------------------------------------------
-- 1. detailed_quiz_data テーブル削除
-- -----------------------------------------------------------------------------
-- 用途: 詳細クイズデータ（quiz_answersに移行済み）
DROP TABLE IF EXISTS public.detailed_quiz_data CASCADE;

-- -----------------------------------------------------------------------------  
-- 2. quiz_results テーブル削除
-- -----------------------------------------------------------------------------
-- 用途: 旧クイズ結果テーブル（quiz_sessionsに移行済み）
DROP TABLE IF EXISTS public.quiz_results CASCADE;

-- -----------------------------------------------------------------------------
-- 3. user_progress テーブル削除  
-- -----------------------------------------------------------------------------
-- 用途: 旧ユーザー進捗テーブル（v2統計システムに移行済み）
DROP TABLE IF EXISTS public.user_progress CASCADE;

-- -----------------------------------------------------------------------------
-- 4. category_progress テーブル削除
-- -----------------------------------------------------------------------------
-- 用途: 旧カテゴリー進捗テーブル（v2へ移行完了済み）
DROP TABLE IF EXISTS public.category_progress CASCADE;

-- -----------------------------------------------------------------------------
-- 5. user_subcategory_xp_stats テーブル削除（v1）
-- -----------------------------------------------------------------------------  
-- 用途: v1サブカテゴリーXP統計（v2へ移行完了済み）
DROP TABLE IF EXISTS public.user_subcategory_xp_stats CASCADE;

-- -----------------------------------------------------------------------------
-- 6. user_category_xp_stats テーブル削除（v1）
-- -----------------------------------------------------------------------------
-- 用途: v1カテゴリーXP統計（v2へ移行完了済み）  
DROP TABLE IF EXISTS public.user_category_xp_stats CASCADE;

-- -----------------------------------------------------------------------------
-- 7. user_xp_stats テーブル削除（v1）
-- -----------------------------------------------------------------------------
-- 用途: v1ユーザーXP統計（v2へ移行完了済み）
DROP TABLE IF EXISTS public.user_xp_stats CASCADE;

-- -----------------------------------------------------------------------------
-- 8. xp_settings テーブル削除
-- -----------------------------------------------------------------------------
-- 用途: 旧XP設定テーブル（xp_level_skp_settingsに移行済み）
DROP TABLE IF EXISTS public.xp_settings CASCADE;

-- =============================================================================
-- 削除確認クエリ
-- =============================================================================
-- 全てのテーブルが削除されたことを確認するクエリ
-- 以下のクエリを実行して、対象テーブルが存在しないことを確認してください

SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN (
    'detailed_quiz_data',
    'quiz_results', 
    'user_progress',
    'category_progress',
    'user_subcategory_xp_stats',
    'user_category_xp_stats', 
    'user_xp_stats',
    'xp_settings'
);

-- 結果が空（0行）であれば削除完了
-- =============================================================================